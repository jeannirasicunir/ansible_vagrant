Vagrant.configure("2") do |config|
  config.vm.define "ansible_target" do |target|
    target.vm.provider "docker" do |d|
      d.build_dir = "."
      d.name = "ansible-container"
      d.remains_running = true
      d.ports = ["2223:22"]
      d.cmd = ["/usr/sbin/sshd", "-D"]
    end

    target.vm.hostname = "ansible-target"
    target.vm.communicator = "ssh"
    target.ssh.username = "root"
    target.ssh.password = "root"
    target.ssh.port = 2223
    target.vm.boot_timeout = 120

    # Inline script that runs the playbook inside the container
    target.vm.provision "ansible_local" do |ansible|
      ansible.playbook = "provisioning/main_playbook.yml"
      ansible.install  = true
    end
  end
end
